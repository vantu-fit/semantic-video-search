<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Setup">
    <meta property="og:description" content="Learn how to build a Semantic Video Search Vector Database using AWS services such as SageMaker, S3, OpenSearch, ECS Fargate, and Lambda.">
    <meta property="og:image" content="https://vantu-fit.github.io/semantic-video-search/images/1/logo.png">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title"  content="Setup">
    <meta name="twitter:description" content="Learn how to build a Semantic Video Search Vector Database using AWS services such as SageMaker, S3, OpenSearch, ECS Fargate, and Lambda.">
    <meta name="twitter:image" content="https://vantu-fit.github.io/semantic-video-search/images/1/logo.png">
    <meta name="twitter:url" content="https://vantu-fit.github.io/semantic-video-search/">

    <meta name="generator" content="Hugo 0.133.0">
    <meta name="description" content="Learn how to build a Semantic Video Search Vector Database using AWS services such as SageMaker, S3, OpenSearch, ECS Fargate, and Lambda.">
<meta name="author" content="daotq2k@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Setup </title>

    
    <link href="/semantic-video-search/css/nucleus.css?1725291367" rel="stylesheet">
    <link href="/semantic-video-search/css/fontawesome-all.min.css?1725291367" rel="stylesheet">
    <link href="/semantic-video-search/css/hybrid.css?1725291367" rel="stylesheet">
    <link href="/semantic-video-search/css/featherlight.min.css?1725291367" rel="stylesheet">
    <link href="/semantic-video-search/css/perfect-scrollbar.min.css?1725291367" rel="stylesheet">
    <link href="/semantic-video-search/css/auto-complete.css?1725291367" rel="stylesheet">
    <link href="/semantic-video-search/css/atom-one-dark-reasonable.css?1725291367" rel="stylesheet">
    <link href="/semantic-video-search/css/theme.css?1725291367" rel="stylesheet">
    <link href="/semantic-video-search/css/hugo-theme.css?1725291367" rel="stylesheet">
    
    <link href="/semantic-video-search/css/theme-workshop.css?1725291367" rel="stylesheet">
    
    

    <script src="/semantic-video-search/js/jquery-3.3.1.min.js?1725291367"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">


    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/semantic-video-search/6-deploy-with-terraform/6.1-settup/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/semantic-video-search/js/lunr.min.js?1725291367"></script>
<script type="text/javascript" src="/semantic-video-search/js/auto-complete.js?1725291367"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/vantu-fit.github.io\/semantic-video-search\/";
    
</script>
<script type="text/javascript" src="/semantic-video-search/js/search.js?1725291367"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/semantic-video-search/1-introduction/" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/1-introduction/">
           <b> 1 </b> Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/semantic-video-search/2-settup-s3/" title="Setting Up S3 for Video Storage" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/2-settup-s3/">
           <b> 2 </b> Setting Up S3 for Video Storage
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/semantic-video-search/3-ingrest-data/" title="Ingesting Data with ECS Fargate" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/3-ingrest-data/">
           <b> 3 </b> Ingesting Data with ECS Fargate
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/3-ingrest-data/3.1-create-vpc/" title="Create VPC" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/3-ingrest-data/3.1-create-vpc/">
           <b> 3.1 </b> Create VPC
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/3-ingrest-data/3.2-erc-repo/" title="Set Up ECR Repository" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/3-ingrest-data/3.2-erc-repo/">
           <b> 3.2 </b> Set Up ECR Repository
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/3-ingrest-data/3.3-ecs-task/" title="Create ECS Task Definition" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/3-ingrest-data/3.3-ecs-task/">
           <b> 3.3 </b> Create ECS Task Definition
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/3-ingrest-data/3.4-run-task/" title="Run ECS Task" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/3-ingrest-data/3.4-run-task/">
           <b> 3.4 </b> Run ECS Task
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/semantic-video-search/4-process-data/" title="Feature Extraction Using SageMaker and ECS" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/4-process-data/">
           <b> 4 </b> Feature Extraction Using SageMaker and ECS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/4-process-data/4.1-extract-keyframes-ecs/" title="Extract Keyframes Using ECS" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/4-process-data/4.1-extract-keyframes-ecs/">
           <b> 4.1 </b> Extract Keyframes Using ECS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/4-process-data/4.2-embedding-processing-sagemaker/" title="Embedding Processing with SageMaker" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/4-process-data/4.2-embedding-processing-sagemaker/">
           <b> 4.2 </b> Embedding Processing with SageMaker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/semantic-video-search/5-vectordb-opensearch/" title="Implementing OpenSearch for Vector Database" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/5-vectordb-opensearch/">
           <b> 5 </b> Implementing OpenSearch for Vector Database
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/5-vectordb-opensearch/5.1-set-up-cluster/" title="Set Up OpenSearch Cluster" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/5-vectordb-opensearch/5.1-set-up-cluster/">
           <b> 5.1 </b> Set Up OpenSearch Cluster
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/5-vectordb-opensearch/5.2-create-index-and-indexing-data/" title="Create Index and Indexing Data With Python SDK" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/5-vectordb-opensearch/5.2-create-index-and-indexing-data/">
           <b> 5.2 </b> Create Index and Indexing Data With Python SDK
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/5-vectordb-opensearch/5.3-query-by-text/" title="Query by Text" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/5-vectordb-opensearch/5.3-query-by-text/">
           <b> 5.3 </b> Query by Text
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/semantic-video-search/6-deploy-with-terraform/" title="Deploy with Terraform" class="dd-item 
        parent
        
        
        ">
      <a href="/semantic-video-search/6-deploy-with-terraform/">
           <b> 6 </b> Deploy with Terraform
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/6-deploy-with-terraform/6.1-settup/" title="Setup" class="dd-item 
        
        active
        
        ">
      <a href="/semantic-video-search/6-deploy-with-terraform/6.1-settup/">
           <b> 6.1 </b> Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/6-deploy-with-terraform/6.2-processing-data/" title="Processing Data" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/6-deploy-with-terraform/6.2-processing-data/">
           <b> 6.2 </b> Processing Data
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/6-deploy-with-terraform/6.3-embedding/" title="Embedding" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/6-deploy-with-terraform/6.3-embedding/">
           <b> 6.3 </b> Embedding
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/6-deploy-with-terraform/6.4-vectordb/" title="Vector Database" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/6-deploy-with-terraform/6.4-vectordb/">
           <b> 6.4 </b> Vector Database
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/semantic-video-search/6-deploy-with-terraform/6.5-cms/" title="CMS" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/6-deploy-with-terraform/6.5-cms/">
           <b> 6.5 </b> CMS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/semantic-video-search/7-clean-up/" title="Clean Up" class="dd-item 
        
        
        
        ">
      <a href="/semantic-video-search/7-clean-up/">
           <b> 7 </b> Clean Up
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://aws.amazon.com/blogs"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - FB Group</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/vantu-fit/"><i class='fab fa-github'></i> GitHub - Đỗ Văn Tư</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.linkedin.com/in/vantudo/"><i class='fab fa-linkedin'></i> Linkedin - Đỗ Văn Tư</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="https://vantu-fit.github.io/semantic-video-search/6-deploy-with-terraform/6.1-settup/" selected>English</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>26-11-2023</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
            <i> <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="https://schema.org/Book">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/semantic-video-search/'>Semantic Video Search Vector Database</a> > <a href='/semantic-video-search/6-deploy-with-terraform/'>Deploy with Terraform</a> > Setup
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-setup-infrastructure">1 Setup Infrastructure</a></li>
        <li><a href="#2-setup-ecr-image--sagemaker-endpoint">2 Setup ECR Image , Sagemaker Endpoint</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Setup
            </h1>
          

        
          <script type="application/ld+json">
            {
              "@context": "https://schema.org",
              "@type": "6-deploy-with-terraform",
              "name": "Setup",
              "description": "Learn how to build a Semantic Video Search Vector Database using AWS services such as SageMaker, S3, OpenSearch, ECS Fargate, and Lambda.",
              "url": "https:\/\/vantu-fit.github.io\/semantic-video-search\/6-deploy-with-terraform\/6.1-settup\/",
              "image": "https:\/\/vantu-fit.github.io\/semantic-video-search\/images\/1\/logo.png",
              "author": {
                "@type": "Person",
                "name": "daotq2k@gmail.com"
              },
              "datePublished": "2024-09-02 22:36:07.7415626 \u002b0700 \u002b07 m=\u002b0.733158001",
              "dateModified": "2024-09-02 22:36:07.7415626 \u002b0700 \u002b07 m=\u002b0.733158001"
            }
          </script>
          <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1014651997538036"
          crossorigin="anonymous"></script>


	<h3 id="1-setup-infrastructure">1 Setup Infrastructure</h3>
<h4 id="11-create-ecr-repo-ecr-repo">1.1 Create ecr repo <code>ecr-repo</code></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-terraform" data-lang="terraform"><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_ecr_repository&#34;</span> <span style="color:#e6db74">&#34;private_repo&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;semantic-repo&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tags</span> = var.<span style="color:#a6e22e">common_tags</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">output</span> <span style="color:#e6db74">&#34;ecr_repo_url&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">value</span> = <span style="color:#a6e22e">aws_ecr_repository</span>.<span style="color:#a6e22e">private_repo</span>.<span style="color:#a6e22e">repository_url</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="12-fectch-opensearch-domain">1.2 Fectch Opensearch domain</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-terraform" data-lang="terraform"><span style="display:flex;"><span><span style="color:#66d9ef">data</span> <span style="color:#e6db74">&#34;aws_opensearch_domain&#34;</span> <span style="color:#e6db74">&#34;semantic_search_domain&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">domain_name</span> = var.<span style="color:#a6e22e">opensearch_domain_name</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="13-create-vpc">1.3 Create VPC</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-terraform" data-lang="terraform"><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># VPC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_vpc&#34;</span> <span style="color:#e6db74">&#34;main&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cidr_block</span> = <span style="color:#e6db74">&#34;172.0.0.0/16&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">enable_dns_support</span> = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">enable_dns_hostnames</span> = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tags</span> = var.<span style="color:#a6e22e">common_tags</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Internet Gateway
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_internet_gateway&#34;</span> <span style="color:#e6db74">&#34;main&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">vpc_id</span> = <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">main</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tags</span>   = var.<span style="color:#a6e22e">common_tags</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Public Subnets
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_subnet&#34;</span> <span style="color:#e6db74">&#34;public&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">count</span> = <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">vpc_id</span> = <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">main</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cidr_block</span> = <span style="color:#e6db74">&#34;172.0.</span><span style="color:#e6db74">${</span>count.<span style="color:#a6e22e">index</span><span style="color:#e6db74">}</span><span style="color:#e6db74">.0/24&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">map_public_ip_on_launch</span> = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tags</span> = var.<span style="color:#a6e22e">common_tags</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Private Subnets
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_subnet&#34;</span> <span style="color:#e6db74">&#34;private&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">count</span> = <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">vpc_id</span> = <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">main</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cidr_block</span> = <span style="color:#e6db74">&#34;172.0.</span><span style="color:#e6db74">${</span>count.<span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">10</span><span style="color:#e6db74">}</span><span style="color:#e6db74">.0/24&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tags</span> = var.<span style="color:#a6e22e">common_tags</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Route Tables
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route_table&#34;</span> <span style="color:#e6db74">&#34;public&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">vpc_id</span> = <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">main</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">route</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cidr_block</span> = <span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gateway_id</span> = <span style="color:#a6e22e">aws_internet_gateway</span>.<span style="color:#a6e22e">main</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tags</span> = var.<span style="color:#a6e22e">common_tags</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route_table_association&#34;</span> <span style="color:#e6db74">&#34;public&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">count</span> = <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">subnet_id</span> = <span style="color:#a6e22e">aws_subnet</span>.<span style="color:#a6e22e">public</span>[count.<span style="color:#a6e22e">index</span>].<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">route_table_id</span> = <span style="color:#a6e22e">aws_route_table</span>.<span style="color:#a6e22e">public</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route_table&#34;</span> <span style="color:#e6db74">&#34;private&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">vpc_id</span> = <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">main</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tags</span> = var.<span style="color:#a6e22e">common_tags</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_route_table_association&#34;</span> <span style="color:#e6db74">&#34;private&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">count</span> = <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">subnet_id</span> = <span style="color:#a6e22e">aws_subnet</span>.<span style="color:#a6e22e">private</span>[count.<span style="color:#a6e22e">index</span>].<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">route_table_id</span> = <span style="color:#a6e22e">aws_route_table</span>.<span style="color:#a6e22e">private</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>}<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># Security Groups
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#################################
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;aws_security_group&#34;</span> <span style="color:#e6db74">&#34;default&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">vpc_id</span> = <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">main</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">egress</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">from_port</span>   = <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">to_port</span>     = <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">protocol</span>    = <span style="color:#e6db74">&#34;-1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cidr_blocks</span> = [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>  }<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  # Allow http traffic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">ingress</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">from_port</span>   = <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">to_port</span>     = <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">protocol</span>    = <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cidr_blocks</span> = [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>    }<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    # Allow https traffic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">ingress</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">from_port</span>   = <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">to_port</span>     = <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">protocol</span>    = <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cidr_blocks</span> = [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>    }<span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    # Allow ssh traffic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">ingress</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">from_port</span>   = <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">to_port</span>     = <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">protocol</span>    = <span style="color:#e6db74">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cidr_blocks</span> = [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tags</span> = var.<span style="color:#a6e22e">common_tags</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">output</span> <span style="color:#e6db74">&#34;vpc_id&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">value</span> = <span style="color:#a6e22e">aws_vpc</span>.<span style="color:#a6e22e">main</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">output</span> <span style="color:#e6db74">&#34;public_subnet_ids&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">value</span> = <span style="color:#a6e22e">aws_subnet</span>.<span style="color:#a6e22e">public</span>[<span style="color:#f92672">*</span>].<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">output</span> <span style="color:#e6db74">&#34;private_subnet_ids&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">value</span> = <span style="color:#a6e22e">aws_subnet</span>.<span style="color:#a6e22e">private</span>[<span style="color:#f92672">*</span>].<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">output</span> <span style="color:#e6db74">&#34;security_group_id&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">value</span> = <span style="color:#a6e22e">aws_security_group</span>.<span style="color:#a6e22e">default</span>.<span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="2-setup-ecr-image--sagemaker-endpoint">2 Setup ECR Image , Sagemaker Endpoint</h3>
<h4 id="21-buid-docker-image-for-processing-data">2.1 Buid docker image for processing data</h4>
<ol>
<li>Create a file <code>Dockerfile</code> in the root directory of the project</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> python:3.9-slim</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get update <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    apt-get install -y ffmpeg <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    pip install boto3<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> extract_keyframes.py /app/extract_keyframes.py<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;python&#34;</span>, <span style="color:#e6db74">&#34;extract_keyframes.py&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><ol start="2">
<li>Create a file <code>extract_keyframes.py</code> in the root directory of the project</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> botocore.exceptions <span style="color:#f92672">import</span> NoCredentialsError
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>S3_BUCKET <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;S3_BUCKET&#39;</span>)
</span></span><span style="display:flex;"><span>INPUT_VIDEO_KEY <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;INPUT_VIDEO_KEY&#39;</span>) 
</span></span><span style="display:flex;"><span>OUTPUT_FOLDER_PREFIX <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;OUTPUT_FOLDER_PREFIX&#39;</span>, <span style="color:#e6db74">&#39;output/&#39;</span>)
</span></span><span style="display:flex;"><span>OUTPUT_MAP_FOLDER <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mapkeyframes&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s3 <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;s3&#39;</span>)
</span></span><span style="display:flex;"><span>lambda_client <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;lambda&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">download_from_s3</span>(bucket, key, download_path):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        s3<span style="color:#f92672">.</span>download_file(bucket, key, download_path)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Downloaded </span><span style="color:#e6db74">{</span>key<span style="color:#e6db74">}</span><span style="color:#e6db74"> from </span><span style="color:#e6db74">{</span>bucket<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> NoCredentialsError:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Error: Not authorized&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">upload_to_s3</span>(bucket, file_path, s3_key):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        s3<span style="color:#f92672">.</span>upload_file(file_path, bucket, s3_key)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Uploaded </span><span style="color:#e6db74">{</span>file_path<span style="color:#e6db74">}</span><span style="color:#e6db74"> to </span><span style="color:#e6db74">{</span>bucket<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>s3_key<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> NoCredentialsError:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Error: Not authorized&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extract_keyframes</span>(video_path, output_folder):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(output_folder):
</span></span><span style="display:flex;"><span>        os<span style="color:#f92672">.</span>makedirs(output_folder)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cmd <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;ffmpeg&#39;</span>, <span style="color:#e6db74">&#39;-i&#39;</span>, video_path, <span style="color:#e6db74">&#39;-vf&#39;</span>, <span style="color:#e6db74">&#39;select=eq(pict_type</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">,I)&#39;</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;-vsync&#39;</span>, <span style="color:#e6db74">&#39;vfr&#39;</span>, <span style="color:#e6db74">&#39;-q:v&#39;</span>, <span style="color:#e6db74">&#39;2&#39;</span>, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>output_folder<span style="color:#e6db74">}</span><span style="color:#e6db74">/%03d.jpg&#39;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>    subprocess<span style="color:#f92672">.</span>run(cmd)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_map_csv</span>(keyframes_folder, csv_path, video_name):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(csv_path, <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;FrameNumber,ImagePath</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> image <span style="color:#f92672">in</span> sorted(os<span style="color:#f92672">.</span>listdir(keyframes_folder)):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> image<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#39;.jpg&#39;</span>):
</span></span><span style="display:flex;"><span>                frame_number <span style="color:#f92672">=</span> int(image<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;.&#39;</span>)[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>                image_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(keyframes_folder, image)
</span></span><span style="display:flex;"><span>                f<span style="color:#f92672">.</span>write(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>frame_number<span style="color:#e6db74">}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{</span>image_path<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Created </span><span style="color:#e6db74">{</span>csv_path<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">invoke_second_lambda</span>(bucket_name, video_name):
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;bucket_name&#39;</span>: bucket_name,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;video_name&#39;</span>: video_name
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Invoke second lambda with payload: </span><span style="color:#e6db74">{</span>payload<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> lambda_client<span style="color:#f92672">.</span>invoke(
</span></span><span style="display:flex;"><span>        FunctionName<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;embedding_data&#34;</span>,
</span></span><span style="display:flex;"><span>        InvocationType<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Event&#39;</span>,  
</span></span><span style="display:flex;"><span>        Payload<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(payload)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Start Embedding ....: </span><span style="color:#e6db74">{</span>response<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Download video</span>
</span></span><span style="display:flex;"><span>    video_name <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>basename(INPUT_VIDEO_KEY)
</span></span><span style="display:flex;"><span>    video_path <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;/tmp/</span><span style="color:#e6db74">{</span>video_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    download_from_s3(S3_BUCKET, INPUT_VIDEO_KEY, video_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    output_folder_name <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>splitext(video_name)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    output_folder <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;/tmp/</span><span style="color:#e6db74">{</span>output_folder_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    extract_keyframes(video_path, output_folder)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    csv_filename <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;map-keyframe-</span><span style="color:#e6db74">{</span>output_folder_name<span style="color:#e6db74">}</span><span style="color:#e6db74">.csv&#39;</span>
</span></span><span style="display:flex;"><span>    csv_path <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;/tmp/</span><span style="color:#e6db74">{</span>csv_filename<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    generate_map_csv(output_folder, csv_path, output_folder_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Upload keyframes and csv to S3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> image <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(output_folder):
</span></span><span style="display:flex;"><span>        upload_to_s3(S3_BUCKET, os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(output_folder, image), <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>OUTPUT_FOLDER_PREFIX<span style="color:#e6db74">}{</span>output_folder_name<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>image<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    upload_to_s3(S3_BUCKET, csv_path, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>OUTPUT_MAP_FOLDER<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>csv_filename<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Invoke second lambda</span>
</span></span><span style="display:flex;"><span>    invoke_second_lambda(S3_BUCKET, output_folder_name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><ol start="3">
<li>Build the docker image
cd to the root directory of the project and run the following command</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>@echo <span style="color:#e6db74">&#34;Building ECS Video&#34;</span>
</span></span><span style="display:flex;"><span>docker build -t ecs-video -f Dockerfile .
</span></span></code></pre></div><ol start="4">
<li>Push the docker image to ECR
You can go to the ECR repository and follow the instructions to push the docker image to ECR or you can run the following command</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>@echo <span style="color:#e6db74">&#34;Pushing ECS Video to ECR&#34;</span>
</span></span><span style="display:flex;"><span>aws ecr get-login-password --region ap-southeast-1 | docker login --username AWS --password-stdin &lt;aws account id&gt;.dkr.ecr.ap-southeast-1.amazonaws.com
</span></span><span style="display:flex;"><span>docker tag ecs-video:latest &lt;aws account id&gt;.dkr.ecr.ap-southeast-1.amazonaws.com/semantic-repo:ecs-video
</span></span><span style="display:flex;"><span>docker push &lt;aws account id&gt;.dkr.ecr.ap-southeast-1.amazonaws.com/semantic-repo:ecs-video
</span></span><span style="display:flex;"><span>@echo <span style="color:#e6db74">&#34;Pushed ECS Video to ECR&#34;</span>
</span></span></code></pre></div><h4 id="22-create-sagemaker-endpoint">2.2 Create Sagemaker Endpoint</h4>
<ol>
<li>Structure of the code</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>|-- code
</span></span><span style="display:flex;"><span>|   |-- inference_code.py
</span></span><span style="display:flex;"><span>|   <span style="color:#e6db74">`</span>-- requirements.txt
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>-- setup.py
</span></span></code></pre></div><ol start="2">
<li>Create a file <code>inference_code.py</code> in the <code>code</code> folder</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sentence_transformers <span style="color:#f92672">import</span> SentenceTransformer
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">model_fn</span>(model_dir):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    model_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(model_dir, <span style="color:#e6db74">&#34;model&#34;</span>)   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> SentenceTransformer(model_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> model
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">input_fn</span>(request_body, request_content_type):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> request_content_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;application/json&#34;</span>:
</span></span><span style="display:flex;"><span>        input_data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(request_body)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> request_body
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> input_data[<span style="color:#e6db74">&#34;text&#34;</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict_fn</span>(input_data, model):
</span></span><span style="display:flex;"><span>    embeddings <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>encode(input_data)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> embeddings
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">output_fn</span>(prediction, content_type):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> content_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;application/json&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>dumps({<span style="color:#e6db74">&#34;embeddings&#34;</span>: prediction<span style="color:#f92672">.</span>tolist()})
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;content type not supported&#34;</span>
</span></span></code></pre></div><ol start="3">
<li>Create a file <code>requirements.txt</code> in the <code>code</code> folder</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sentence_transformers
</span></span></code></pre></div><ol start="4">
<li>Create a file <code>setup.py</code> in the root directory of the project.</li>
</ol>
<ul>
<li>Before running the <code>setup.py</code>, you need create a role for the sagemaker endpoint to access the S3 bucket <code>sagemaker-local</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sentence_transformers <span style="color:#f92672">import</span> SentenceTransformer
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> tarfile
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sagemaker.pytorch <span style="color:#f92672">import</span> PyTorchModel
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Wait for about 5 minutes</span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> SentenceTransformer(<span style="color:#e6db74">&#39;clip-ViT-B-32&#39;</span>)
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#39;model&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;model/&#39;</span>
</span></span><span style="display:flex;"><span>code_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;code/&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Wait for about 5 minutes</span>
</span></span><span style="display:flex;"><span>zipped_model_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(model_path, <span style="color:#e6db74">&#34;model.tar.gz&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> tarfile<span style="color:#f92672">.</span>open(zipped_model_path, <span style="color:#e6db74">&#34;w:gz&#34;</span>) <span style="color:#66d9ef">as</span> tar:
</span></span><span style="display:flex;"><span>    tar<span style="color:#f92672">.</span>add(model_path)
</span></span><span style="display:flex;"><span>    tar<span style="color:#f92672">.</span>add(code_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Wait for about 20 minutes</span>
</span></span><span style="display:flex;"><span>endpoint_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;clip-model-&#34;</span> <span style="color:#f92672">+</span> time<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#34;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">-%H-%M-%S&#34;</span>, time<span style="color:#f92672">.</span>gmtime())
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> PyTorchModel(
</span></span><span style="display:flex;"><span>    entry_point<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;inference_code.py&#34;</span>,
</span></span><span style="display:flex;"><span>    model_data<span style="color:#f92672">=</span>zipped_model_path,
</span></span><span style="display:flex;"><span>    role<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;arn:aws:iam::&lt;aws account id&gt;:role/sagemaker-local&#34;</span>,
</span></span><span style="display:flex;"><span>    framework_version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.5&#34;</span>,
</span></span><span style="display:flex;"><span>    py_version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;py3&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>predictor <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>deploy(
</span></span><span style="display:flex;"><span>    initial_instance_count<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, instance_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ml.m5.xlarge&#34;</span>, endpoint_name<span style="color:#f92672">=</span>endpoint_name
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Wait total of 30 minutes</span>
</span></span></code></pre></div><ol start="5">
<li>Run the <code>setup.py</code> file</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python setup.py
</span></span></code></pre></div><p>Wait for about 30 minutes for the endpoint to be created</p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/semantic-video-search/6-deploy-with-terraform/" title="Deploy with Terraform"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/semantic-video-search/6-deploy-with-terraform/6.2-processing-data/" title="Processing Data" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/semantic-video-search/js/clipboard.min.js?1725291367"></script>
    <script src="/semantic-video-search/js/perfect-scrollbar.min.js?1725291367"></script>
    <script src="/semantic-video-search/js/perfect-scrollbar.jquery.min.js?1725291367"></script>
    <script src="/semantic-video-search/js/jquery.sticky.js?1725291367"></script>
    <script src="/semantic-video-search/js/featherlight.min.js?1725291367"></script>
    <script src="/semantic-video-search/js/highlight.pack.js?1725291367"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/semantic-video-search/js/modernizr.custom-3.6.0.js?1725291367"></script>
    <script src="/semantic-video-search/js/learn.js?1725291367"></script>
    <script src="/semantic-video-search/js/hugo-learn.js?1725291367"></script>

    <link href="/semantic-video-search/mermaid/mermaid.css?1725291367" rel="stylesheet" />
    <script src="/semantic-video-search/mermaid/mermaid.js?1725291367"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>


        <script type="module">
          
          import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
          import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-analytics.js";
          
          

          
          
          const firebaseConfig = {
            apiKey: "AIzaSyBk4I0jICesRliX2d-MkhqQrrxkaq1bqZM",
            authDomain: "aws-hands-on-da9b8.firebaseapp.com",
            projectId: "aws-hands-on-da9b8",
            storageBucket: "aws-hands-on-da9b8.appspot.com",
            messagingSenderId: "99697369891",
            appId: "1:99697369891:web:5c0dc4e7dbf53534a5e296",
            measurementId: "G-74VPJT2D9C"
          };

          
          const app = initializeApp(firebaseConfig);
          const analytics = getAnalytics(app);
        </script>
  </body>
</html>
